<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Шаг за шагом</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #ffffff, #f5f5f5);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
        }
        
        .game-container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            padding: 20px 0;
            margin-bottom: 20px;
        }
        
        h1 {
            font-size: 3rem;
            color: #2e7d32;
            text-shadow: 0 0 10px rgba(46, 125, 50, 0.2);
        }
        
        .game-content {
            display: flex;
            flex: 1;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .left-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .right-panel {
            flex: 2;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            background-color: rgba(46, 125, 50, 0.1);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .stat {
            text-align: center;
            padding: 10px;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #2e7d32;
            margin-top: 5px;
        }
        
        .step-btn {
            padding: 20px;
            font-size: 1.5rem;
            background: linear-gradient(to right, #2e7d32, #4caf50);
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .step-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        .step-btn:active {
            transform: translateY(2px);
        }
        
        .step-btn:disabled {
            background: #bdbdbd;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .battle-section, .shop-section, .level-up-section, .inventory-section, .ore-section, .end-game-section {
            display: none;
            background-color: rgba(46, 125, 50, 0.1);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .battle-info {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.3rem;
        }
        
        .enemy-info {
            font-weight: bold;
            color: #d32f2f;
            margin-bottom: 10px;
        }
        
        .health-bars {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .health-container {
            flex: 1;
        }
        
        .health-label {
            text-align: center;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .enemy-health, .player-health {
            height: 30px;
            background-color: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .health-bar {
            height: 100%;
            border-radius: 15px;
            transition: width 0.5s;
        }
        
        .enemy-health .health-bar {
            background: linear-gradient(to right, #d32f2f, #f44336);
        }
        
        .player-health .health-bar {
            background: linear-gradient(to right, #2e7d32, #4caf50);
        }
        
        .dodge-info {
            text-align: center;
            margin: 15px 0;
            font-size: 1.2rem;
        }
        
        .battle-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
            position: relative;
            transition: all 0.5s;
        }
        
        .battle-btn {
            padding: 15px;
            font-size: 1.2rem;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
        }
        
        .attack-btn, .defend-btn {
            background: linear-gradient(to right, #2e7d32, #4caf50);
            color: white;
        }
        
        .dodge-btn {
            background: linear-gradient(to right, #ff9800, #ffb74d);
            color: white;
            padding: 15px;
            font-size: 1.2rem;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
        }
        
        .battle-btn:hover:not(:disabled), .dodge-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
        }
        
        .battle-btn:disabled, .dodge-btn:disabled {
            background: #bdbdbd;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .black-attack {
            background: #000 !important;
            color: white;
        }
        
        .weapon-minigame {
            display: none;
            text-align: center;
            margin-top: 15px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 10px;
        }
        
        .minigame-btn {
            padding: 10px 20px;
            margin: 5px;
            background: #2e7d32;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .minigame-timer {
            height: 10px;
            background: #e0e0e0;
            border-radius: 5px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .timer-bar {
            height: 100%;
            background: #4caf50;
            width: 100%;
        }
        
        .shop-items {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .shop-item {
            background: rgba(46, 125, 50, 0.15);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.05);
        }
        
        .shop-item h3 {
            margin-bottom: 10px;
            color: #2e7d32;
        }
        
        .shop-btn {
            padding: 12px 20px;
            width: 100%;
            background: linear-gradient(to right, #2e7d32, #4caf50);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
        }
        
        .shop-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
        }
        
        .shop-btn:disabled {
            background: #bdbdbd;
            cursor: not-allowed;
        }
        
        .shop-actions {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }
        
        .continue-btn {
            padding: 15px 30px;
            background: linear-gradient(to right, #ff9800, #ffb74d);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1.2rem;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
        }
        
        .continue-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
        }
        
        .message-container {
            background-color: rgba(46, 125, 50, 0.1);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 1.3rem;
        }
        
        .enemy-turn {
            background-color: rgba(211, 47, 47, 0.1);
        }
        
        .player-turn {
            background-color: rgba(46, 125, 50, 0.1);
        }
        
        .inventory-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .inventory-item {
            background: rgba(255, 255, 255, 0.7);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
        }
        
        .inventory-btn {
            padding: 8px 15px;
            background: #2e7d32;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            width: 100%;
        }
        
        .level-up-options {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-top: 20px;
        }
        
        .level-up-btn {
            padding: 15px;
            background: linear-gradient(to right, #2e7d32, #4caf50);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1rem;
        }
        
        .ore-section {
            text-align: center;
        }
        
        .ore-info {
            margin-bottom: 20px;
            font-size: 1.2rem;
        }
        
        .ore-image {
            font-size: 5rem;
            margin: 20px 0;
        }
        
        .mine-btn {
            padding: 15px 30px;
            font-size: 1.2rem;
            background: linear-gradient(to right, #ff9800, #ffb74d);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            margin: 10px;
        }
        
        .circles-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }
        
        .circle {
            position: absolute;
            width: 50px;
            height: 50px;
            background: red;
            border-radius: 50%;
            cursor: pointer;
            pointer-events: all;
        }
        
        .end-game-section {
            text-align: center;
        }
        
        .end-game-title {
            font-size: 3rem;
            color: #2e7d32;
            margin-bottom: 20px;
        }
        
        .end-game-stats {
            font-size: 1.5rem;
            margin-bottom: 30px;
        }
        
        .restart-btn {
            padding: 15px 30px;
            font-size: 1.5rem;
            background: linear-gradient(to right, #2e7d32, #4caf50);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
        }
        
        .music-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }
        
        .music-btn {
            padding: 8px 15px;
            background: #2e7d32;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        /* Адаптивность для мобильных устройств */
        @media (max-width: 768px) {
            .game-content {
                flex-direction: column;
            }
            
            .stats {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .battle-actions {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .stat-value {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <header>
            <h1>Шаг за шагом</h1>
            <div class="music-controls">
                <button class="music-btn" id="mainMusicBtn">Основная</button>
                <button class="music-btn" id="boss50MusicBtn">Король слизней</button>
                <button class="music-btn" id="boss100MusicBtn">Теневой лорд</button>
                <button class="music-btn" id="boss250MusicBtn">ERROR</button>
                <button class="music-btn" id="boss500MusicBtn">Бог зла</button>
                <button class="music-btn" id="boss999MusicBtn">Бесконечность</button>
                <button class="music-btn" id="stopMusicBtn">Выкл музыку</button>
            </div>
        </header>
        
        <div class="game-content">
            <div class="left-panel">
                <div class="stats">
                    <div class="stat">
                        <div>Шаги</div>
                        <div class="stat-value" id="steps">0</div>
                    </div>
                    <div class="stat">
                        <div>Монеты</div>
                        <div class="stat-value" id="coins">0</div>
                    </div>
                    <div class="stat">
                        <div>Здоровье</div>
                        <div class="stat-value" id="health">5/5</div>
                    </div>
                    <div class="stat">
                        <div>Урон</div>
                        <div class="stat-value" id="damage">1</div>
                    </div>
                    <div class="stat">
                        <div>Уровень</div>
                        <div class="stat-value" id="level">1</div>
                    </div>
                    <div class="stat">
                        <div>Опыт</div>
                        <div class="stat-value" id="exp">0/100</div>
                    </div>
                </div>
                
                <button class="step-btn" id="stepBtn">Сделать шаг</button>
                
                <div class="inventory-section" id="inventorySection">
                    <div class="battle-info">Инвентарь</div>
                    <div class="inventory-items" id="inventoryItems">
                        <!-- Инвентарь будет заполняться динамически -->
                    </div>
                </div>
                
                <div class="message-container" id="message">
                    Сделайте шаг, чтобы начать игру!
                </div>
            </div>
            
            <div class="right-panel">
                <div class="battle-section" id="battleSection">
                    <div class="battle-info">
                        <div class="enemy-info" id="enemyInfo">На вас напал враг!</div>
                    </div>
                    
                    <div class="health-bars">
                        <div class="health-container">
                            <div class="health-label">Враг: <span id="enemyHp">5</span>/<span id="enemyMaxHp">5</span> HP</div>
                            <div class="enemy-health">
                                <div class="health-bar" id="enemyHealthBar" style="width: 100%"></div>
                            </div>
                        </div>
                        
                        <div class="health-container">
                            <div class="health-label">Вы: <span id="playerHp">5</span>/<span id="playerMaxHp">5</span> HP</div>
                            <div class="player-health">
                                <div class="health-bar" id="playerHealthBar" style="width: 100%"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="dodge-info">
                        Увороты: <span id="dodgeCount">3</span>/3
                    </div>
                    
                    <div class="battle-actions" id="playerActions">
                        <button class="battle-btn attack-btn" id="attackBtn">Атаковать</button>
                        <button class="battle-btn defend-btn" id="defendBtn">Защита</button>
                        <button class="dodge-btn" id="dodgeBtn">Увернуться</button>
                    </div>
                    
                    <div class="weapon-minigame" id="weaponMinigame">
                        <!-- Мини-игры для оружия будут здесь -->
                    </div>
                </div>
                
                <div class="shop-section" id="shopSection">
                    <div class="battle-info">Магазин</div>
                    
                    <div class="shop-items" id="shopItems">
                        <!-- Товары магазина будут заполняться динамически -->
                    </div>
                    
                    <div class="shop-actions">
                        <button class="continue-btn" id="continueBtn">Продолжить путь</button>
                    </div>
                </div>
                
                <div class="ore-section" id="oreSection">
                    <div class="battle-info">Золотая руда!</div>
                    <div class="ore-info">Ударьте киркой по руде 30 раз, чтобы добыть её</div>
                    <div class="ore-image">⛏️</div>
                    <div class="ore-info">Ударов: <span id="mineCount">0</span>/30</div>
                    <button class="mine-btn" id="mineBtn">Добывать</button>
                    <button class="continue-btn" id="oreContinueBtn">Продолжить путь</button>
                </div>
                
                <div class="level-up-section" id="levelUpSection">
                    <div class="battle-info">Повышение уровня!</div>
                    <div class="level-up-options">
                        <button class="level-up-btn" id="levelUpDodge">+1 уворот</button>
                        <button class="level-up-btn" id="levelUpCoins">+3 монеты за шаг</button>
                        <button class="level-up-btn" id="levelUpBonus">+100 монет</button>
                    </div>
                </div>
                
                <div class="end-game-section" id="endGameSection">
                    <div class="end-game-title">ПОБЕДА!</div>
                    <div class="end-game-stats">
                        <p>Вы достигли 1000 шагов и победили!</p>
                        <p>Ваш финальный счет: <span id="finalScore">0</span> монет</p>
                        <p>Ваш уровень: <span id="finalLevel">1</span></p>
                    </div>
                    <button class="restart-btn" id="restartBtn">Начать заново</button>
                </div>
            </div>
        </div>
    </div>

    <div class="circles-container" id="circlesContainer">
        <!-- Кружки для способности босса будут добавляться сюда -->
    </div>

    <!-- Аудио элементы для музыки -->
    <audio id="mainMusic" loop>
        <source src="">
    </audio>
    
    <audio id="boss50Music" loop>
        <source src="1-15. Wait Of The World .mp3" type="audio/mpeg">
    </audio>
    
    <audio id="boss100Music" loop>
        <source src="1-21. Search Party  (1).mp3">
    </audio>
    
    <audio id="boss250Music" loop>
        <source src="25. Universal Collapse.mp3">
    </audio>
    
    <audio id="boss500Music" loop>
        <source src="35. Hadopelagic Pressure.mp3">
    </audio>
    
    <audio id="boss999Music" loop>
        <source src="39. Stained, Brutal Calamity.mp3">
    </audio>

    <script>
        // Игровые переменные
        let steps = 0;
        let coins = 0;
        let playerHealth = 5;
        let playerMaxHealth = 5;
        let playerDamage = 1;
        let playerBaseDamage = 1;
        let enemyHealth = 5;
        let enemyMaxHealth = 5;
        let enemyDamage = 1;
        let enemyType = 'обычный';
        let dodgesLeft = 3;
        let maxDodges = 3;
        let isPlayerTurn = true;
        let isBattleActive = false;
        let isShopActive = false;
        let isLevelUpActive = false;
        let isOreActive = false;
        let currentWeapon = 'кулаки';
        let hasIronArmor = false;
        let hasDiamondArmor = false;
        let hasGodArmor = false;
        let hasPickaxe = false;
        let experience = 0;
        let level = 1;
        let expToNextLevel = 100;
        let coinsPerStep = 1;
        let inventory = [];
        let blackAttackActive = false;
        let blackInventoryActive = false;
        let buttonsMoved = false;
        let originalButtonOrder = [];
        let mineCount = 0;
        let toxicDamageInterval;
        let bossAbilityInterval;
        let circlesInterval;
        let currentMusic = null;
        let nextAttackMultiplier = 1; // Множитель для следующей атаки
        let nextAttackBonusDamage = 0; // Бонусный урон для следующей атаки
        let nextEnemyDamageReduction = 1; // Уменьшение урона врага для следующей атаки
        
        // Элементы DOM
        const stepsElement = document.getElementById('steps');
        const coinsElement = document.getElementById('coins');
        const healthElement = document.getElementById('health');
        const damageElement = document.getElementById('damage');
        const levelElement = document.getElementById('level');
        const expElement = document.getElementById('exp');
        const stepBtn = document.getElementById('stepBtn');
        const battleSection = document.getElementById('battleSection');
        const shopSection = document.getElementById('shopSection');
        const levelUpSection = document.getElementById('levelUpSection');
        const inventorySection = document.getElementById('inventorySection');
        const oreSection = document.getElementById('oreSection');
        const endGameSection = document.getElementById('endGameSection');
        const enemyInfoElement = document.getElementById('enemyInfo');
        const enemyHpElement = document.getElementById('enemyHp');
        const enemyMaxHpElement = document.getElementById('enemyMaxHp');
        const playerHpElement = document.getElementById('playerHp');
        const playerMaxHpElement = document.getElementById('playerMaxHp');
        const enemyHealthBar = document.getElementById('enemyHealthBar');
        const playerHealthBar = document.getElementById('playerHealthBar');
        const dodgeCountElement = document.getElementById('dodgeCount');
        const playerActions = document.getElementById('playerActions');
        const attackBtn = document.getElementById('attackBtn');
        const defendBtn = document.getElementById('defendBtn');
        const dodgeBtn = document.getElementById('dodgeBtn');
        const weaponMinigame = document.getElementById('weaponMinigame');
        const messageElement = document.getElementById('message');
        const shopItemsElement = document.getElementById('shopItems');
        const continueBtn = document.getElementById('continueBtn');
        const inventoryItemsElement = document.getElementById('inventoryItems');
        const levelUpDodgeBtn = document.getElementById('levelUpDodge');
        const levelUpCoinsBtn = document.getElementById('levelUpCoins');
        const levelUpBonusBtn = document.getElementById('levelUpBonus');
        const mineBtn = document.getElementById('mineBtn');
        const mineCountElement = document.getElementById('mineCount');
        const oreContinueBtn = document.getElementById('oreContinueBtn');
        const circlesContainer = document.getElementById('circlesContainer');
        const finalScoreElement = document.getElementById('finalScore');
        const finalLevelElement = document.getElementById('finalLevel');
        const restartBtn = document.getElementById('restartBtn');
        
        // Элементы музыки
        const mainMusicBtn = document.getElementById('mainMusicBtn');
        const boss50MusicBtn = document.getElementById('boss50MusicBtn');
        const boss100MusicBtn = document.getElementById('boss100MusicBtn');
        const boss250MusicBtn = document.getElementById('boss250MusicBtn');
        const boss500MusicBtn = document.getElementById('boss500MusicBtn');
        const boss999MusicBtn = document.getElementById('boss999MusicBtn');
        const stopMusicBtn = document.getElementById('stopMusicBtn');
        
        // Магазин товаров
        const shopItems = [
            { id: 'maxHp', name: '+1 к макс HP', price: 25, description: 'Увеличивает максимальное здоровье на 1', type: 'stat' },
            { id: 'pickaxe', name: 'Кирка', price: 10, description: 'Позволяет добывать золотую руду', type: 'tool' },
            { id: 'glove', name: 'Перчатка', price: 50, description: 'Увеличивает урон до 2', type: 'weapon' },
            { id: 'healthSphere', name: 'Сфера жизни', price: 50, description: 'Лечит 15 HP', type: 'consumable' },
            { id: 'rageSphere', name: 'Сфера ярости', price: 50, description: 'Удваивает урон следующей атаки', type: 'consumable' },
            { id: 'comboSphere', name: 'Сфера комбо', price: 70, description: '+10 HP и след атака в 2 раза больше урона', type: 'consumable' },
            { id: 'sword', name: 'Меч', price: 250, description: 'Наносит 4 урона', type: 'weapon' },
            { id: 'ironArmor', name: 'Железная броня', price: 200, description: 'Уменьшает урон врагов на 20%', type: 'armor' },
            { id: 'baton', name: 'Батон', price: 325, description: 'Лечит 10 HP + следующий урон врага уменьшен вдвое', type: 'consumable' },
            { id: 'mushroomBottle', name: 'Бутылочка опята', price: 100, description: 'Даёт 50 опыта', type: 'consumable' },
            { id: 'godSphere', name: 'Сфера бога', price: 333, description: 'Жертвует 5 HP, следующая атака наносит 5x урон', type: 'consumable' },
            { id: 'spear', name: 'Копьё', price: 500, description: 'Наносит 3-6 урона ', type: 'weapon' },
            { id: 'pistol', name: 'Пистолет', price: 750, description: 'Наносит 5 урона', type: 'weapon' },
            { id: 'eternityGlove', name: 'Перчатка вечности', price: 1500, description: 'Наносит 10 урона', type: 'weapon' },
            { id: 'diamondArmor', name: 'Броня алмаза', price: 1000, description: 'Уменьшает урон врагов на 40%', type: 'armor' },
            { id: 'godSword', name: 'Меч бога', price: 2500, description: 'Наносит 20 урона (требует мини-игру)', type: 'weapon' },
            { id: 'godArmor', name: 'Броня бога', price: 3000, description: 'Уменьшает урон врагов на 60%', type: 'armor' }
        ];
        
        // Функция для воспроизведения музыки
        function playMusic(musicId) {
            // Останавливаем текущую музыку
            if (currentMusic) {
                currentMusic.pause();
                currentMusic.currentTime = 0;
            }
            
            // Включаем новую музыку
            const music = document.getElementById(musicId);
            if (music) {
                music.volume = 0.5; // Устанавливаем громкость 50%
                music.play().catch(e => {
                    console.log("Автовоспроизведение заблокировано:", e);
                });
                currentMusic = music;
            }
        }
        
        // Функция для остановки музыки
        function stopMusic() {
            if (currentMusic) {
                currentMusic.pause();
                currentMusic.currentTime = 0;
                currentMusic = null;
            }
        }
        
        // Функция обновления интерфейса
        function updateUI() {
            stepsElement.textContent = steps;
            coinsElement.textContent = coins;
            healthElement.textContent = `${playerHealth}/${playerMaxHealth}`;
            damageElement.textContent = playerDamage;
            levelElement.textContent = level;
            expElement.textContent = `${experience}/${expToNextLevel}`;
            
            // Обновление здоровья в бою
            if (isBattleActive) {
                enemyHpElement.textContent = enemyHealth;
                enemyMaxHpElement.textContent = enemyMaxHealth;
                playerHpElement.textContent = playerHealth;
                playerMaxHpElement.textContent = playerMaxHealth;
                enemyHealthBar.style.width = `${(enemyHealth / enemyMaxHealth) * 100}%`;
                playerHealthBar.style.width = `${(playerHealth / playerMaxHealth) * 100}%`;
                dodgeCountElement.textContent = `${dodgesLeft}/${maxDodges}`;
                
                // Обновление доступности кнопки уворота
                dodgeBtn.disabled = dodgesLeft <= 0 || isPlayerTurn;
            }
            
            // Обновление инвентаря
            updateInventory();
        }
        
        // Функция для показа сообщения
        function showMessage(text, isPlayerTurn = true) {
            messageElement.textContent = text;
            messageElement.className = 'message-container ' + (isPlayerTurn ? 'player-turn' : 'enemy-turn');
        }
        
        // Функция для совершения шага
        function makeStep() {
            if (isShopActive || isBattleActive || isLevelUpActive || isOreActive) {
                return;
            }
            
            steps++;
            
            // Проверка на конец игры
            if (steps >= 1000) {
                endGame();
                return;
            }
            
            // На 35 шаге даем бонус
            if (steps === 35) {
                coins += 100;
                showMessage(`Вы достигли 35 шагов! Получено 100 монет.`);
            }
            
            // Случайное количество монет за шаг
            const coinsEarned = Math.floor(Math.random() * 25) + coinsPerStep;
            coins += coinsEarned;
            
            // Получение опыта за шаг
            gainExperience(5);
            
            showMessage(`Вы сделали шаг! Получено монет: ${coinsEarned}`);
            
            // Проверка на золотую руду (5% шанс, если есть кирка)
            if (hasPickaxe && Math.random() < 0.05) {
                showOre();
                return;
            }
            
            // Проверка на появление магазина (каждые 10 шагов, кроме 50, 100, 250, 500, 999)
            if (steps % 10 === 0 && ![50, 100, 250, 500, 999].includes(steps)) {
                showShop();
                return;
            }
            
            // Проверка на боссов
            if (steps === 50) {
                startBossBattle('Король слизней');
                return;
            }
            
            if (steps === 100) {
                startBossBattle('Теневой лорд');
                return;
            }
            
            if (steps === 250) {
                startBossBattle('ERROR');
                return;
            }
            
            if (steps === 500) {
                startBossBattle('БОГ ЗЛА');
                return;
            }
            
            if (steps === 999) {
                startBossBattle('БЕСКОНЕЧНОСТЬ');
                return;
            }
            
            // Шанс встретить врага (20%)
            if (Math.random() < 0.2) {
                startBattle();
            }
            
            updateUI();
        }
        
        // Функция для начала обычного боя
        function startBattle() {
            isBattleActive = true;
            battleSection.style.display = 'block';
            stepBtn.disabled = true;
            
            // Восстанавливаем урон игрока
            playerDamage = playerBaseDamage;
            
            // Включаем основную музыку для обычных врагов
            playMusic('mainMusic');
            
            // Определение типа врага в зависимости от шагов
            let enemyChance = Math.random();
            let hpMultiplier = 1;
            
            // На 200+ шагах враги имеют в 2 раза больше HP
            if (steps >= 200) {
                hpMultiplier = 2;
            }
            
            if (steps >= 500) {
                // После 500 шагов
                if (enemyChance < 0.1) {
                    // Токсичный (усиленный)
                    enemyType = 'токсичный';
                    enemyMaxHealth = 75 * hpMultiplier;
                    enemyHealth = 75 * hpMultiplier;
                    enemyDamage = 2;
                } else if (enemyChance < 0.25) {
                    // Пожиратель душ
                    enemyType = 'пожиратель душ';
                    enemyMaxHealth = 50 * hpMultiplier;
                    enemyHealth = 50 * hpMultiplier;
                    enemyDamage = 3;
                } else if (enemyChance < 0.4) {
                    // Слизень
                    enemyType = 'слизень';
                    enemyMaxHealth = 60 * hpMultiplier;
                    enemyHealth = 60 * hpMultiplier;
                    enemyDamage = 2;
                } else {
                    // Обычный враг
                    enemyType = 'обычный';
                    enemyMaxHealth = 45 * hpMultiplier;
                    enemyHealth = 45 * hpMultiplier;
                    enemyDamage = 1;
                }
            } else if (steps >= 450) {
                // После 450 шагов
                if (enemyChance < 0.1) {
                    // Токсичный (усиленный)
                    enemyType = 'токсичный';
                    enemyMaxHealth = 75 * hpMultiplier;
                    enemyHealth = 75 * hpMultiplier;
                    enemyDamage = 2;
                } else if (enemyChance < 0.25) {
                    // Пожиратель душ
                    enemyType = 'пожиратель душ';
                    enemyMaxHealth = 50 * hpMultiplier;
                    enemyHealth = 50 * hpMultiplier;
                    enemyDamage = 3;
                } else if (enemyChance < 0.4) {
                    // Слизень
                    enemyType = 'слизень';
                    enemyMaxHealth = 60 * hpMultiplier;
                    enemyHealth = 60 * hpMultiplier;
                    enemyDamage = 2;
                } else {
                    // Обычный враг
                    enemyType = 'обычный';
                    enemyMaxHealth = 45 * hpMultiplier;
                    enemyHealth = 45 * hpMultiplier;
                    enemyDamage = 1;
                }
            } else if (steps >= 260) {
                // После 260 шагов
                if (enemyChance < 0.1) {
                    // Токсичный
                    enemyType = 'токсичный';
                    enemyMaxHealth = 40 * hpMultiplier;
                    enemyHealth = 40 * hpMultiplier;
                    enemyDamage = 2;
                } else if (enemyChance < 0.25) {
                    // Пожиратель душ
                    enemyType = 'пожиратель душ';
                    enemyMaxHealth = 50 * hpMultiplier;
                    enemyHealth = 50 * hpMultiplier;
                    enemyDamage = 3;
                } else if (enemyChance < 0.4) {
                    // Слизень
                    enemyType = 'слизень';
                    enemyMaxHealth = 60 * hpMultiplier;
                    enemyHealth = 60 * hpMultiplier;
                    enemyDamage = 2;
                } else {
                    // Обычный враг
                    enemyType = 'обычный';
                    enemyMaxHealth = 45 * hpMultiplier;
                    enemyHealth = 45 * hpMultiplier;
                    enemyDamage = 1;
                }
            } else if (steps >= 250) {
                // После 250 шагов
                if (enemyChance < 0.1) {
                    // Пожиратель душ
                    enemyType = 'пожиратель душ';
                    enemyMaxHealth = 50 * hpMultiplier;
                    enemyHealth = 50 * hpMultiplier;
                    enemyDamage = 3;
                } else if (enemyChance < 0.25) {
                    // Слизень
                    enemyType = 'слизень';
                    enemyMaxHealth = 60 * hpMultiplier;
                    enemyHealth = 60 * hpMultiplier;
                    enemyDamage = 2;
                } else {
                    // Обычный враг
                    enemyType = 'обычный';
                    enemyMaxHealth = 45 * hpMultiplier;
                    enemyHealth = 45 * hpMultiplier;
                    enemyDamage = 1;
                }
            } else if (steps >= 130) {
                // После 130 шагов
                if (enemyChance < 0.1) {
                    // Пожиратель душ
                    enemyType = 'пожиратель душ';
                    enemyMaxHealth = 50 * hpMultiplier;
                    enemyHealth = 50 * hpMultiplier;
                    enemyDamage = 3;
                } else if (enemyChance < 0.25) {
                    // Слизень
                    enemyType = 'слизень';
                    enemyMaxHealth = 60 * hpMultiplier;
                    enemyHealth = 60 * hpMultiplier;
                    enemyDamage = 2;
                } else {
                    // Обычный враг
                    enemyType = 'обычный';
                    enemyMaxHealth = 45 * hpMultiplier;
                    enemyHealth = 45 * hpMultiplier;
                    enemyDamage = 1;
                }
            } else if (steps >= 70) {
                // После 70 шагов
                if (enemyChance < 0.15) {
                    // Слизень
                    enemyType = 'слизень';
                    enemyMaxHealth = 45 * hpMultiplier;
                    enemyHealth = 45 * hpMultiplier;
                    enemyDamage = 2;
                } else {
                    // Обычный враг
                    enemyType = 'обычный';
                    enemyMaxHealth = 30 * hpMultiplier;
                    enemyHealth = 30 * hpMultiplier;
                    enemyDamage = 1;
                }
            } else if (steps >= 30) {
                // После 30 шагов
                if (enemyChance < 0.15) {
                    // Слизень
                    enemyType = 'слизень';
                    enemyMaxHealth = 30 * hpMultiplier;
                    enemyHealth = 30 * hpMultiplier;
                    enemyDamage = 2;
                } else {
                    // Обычный враг
                    enemyType = 'обычный';
                    enemyMaxHealth = 15 * hpMultiplier;
                    enemyHealth = 15 * hpMultiplier;
                    enemyDamage = 1;
                }
            } else if (steps >= 20) {
                // После 20 шагов
                enemyType = 'обычный';
                enemyMaxHealth = 15 * hpMultiplier;
                enemyHealth = 15 * hpMultiplier;
                enemyDamage = 1;
            } else {
                // До 20 шагов
                enemyType = 'обычный';
                enemyMaxHealth = 5 * hpMultiplier;
                enemyHealth = 5 * hpMultiplier;
                enemyDamage = 1;
            }
            
            // Сброс параметров боя
            dodgesLeft = maxDodges;
            isPlayerTurn = true;
            
            enemyInfoElement.textContent = `На вас напал ${enemyType === 'обычный' ? 'враг' : enemyType}!`;
            
            showMessage(`Враг атаковал вас! Ваш ход.`);
            updateUI();
            
            // Запуск эффекта черной кнопки только на 100 шаге и далее
            if (steps >= 100) {
                startBlackButtonEffect();
            }
            
            // Для токсичного врага запускаем эффект яда
            if (enemyType === 'токсичный') {
                startToxicDamage();
            }
            
            // Для босса ERROR запускаем эффект перемещения кнопок
            if (enemyType === 'ERROR') {
                startButtonMoveEffect();
            }
            
            // Для босса БОГ ЗЛА запускаем его способности
            if (enemyType === 'БОГ ЗЛА') {
                startEvilGodAbilities();
            }
            
            // Для босса БЕСКОНЕЧНОСТЬ запускаем его способности
            if (enemyType === 'БЕСКОНЕЧНОСТЬ') {
                startInfinityAbilities();
            }
        }
        
        // Функция для начала боя с боссом
        function startBossBattle(bossName) {
            isBattleActive = true;
            battleSection.style.display = 'block';
            stepBtn.disabled = true;
            
            // Восстанавливаем урон игрока
            playerDamage = playerBaseDamage;
            
            enemyType = bossName;
            
            // Включаем музыку в зависимости от босса
            switch(bossName) {
                case 'Король слизней':
                    playMusic('boss50Music');
                    enemyMaxHealth = 50;
                    enemyHealth = 50;
                    enemyDamage = 4;
                    break;
                case 'Теневой лорд':
                    playMusic('boss100Music');
                    enemyMaxHealth = 100;
                    enemyHealth = 100;
                    enemyDamage = 2;
                    break;
                case 'ERROR':
                    playMusic('boss250Music');
                    enemyMaxHealth = 404;
                    enemyHealth = 404;
                    enemyDamage = 1; // Будет случайным от 1 до 4
                    break;
                case 'БОГ ЗЛА':
                    playMusic('boss500Music');
                    enemyMaxHealth = 222;
                    enemyHealth = 222;
                    enemyDamage = 3;
                    break;
                case 'БЕСКОНЕЧНОСТЬ':
                    playMusic('boss999Music');
                    enemyMaxHealth = 1000;
                    enemyHealth = 1000;
                    enemyDamage = 5;
                    break;
            }
            
            // Сброс параметров боя
            dodgesLeft = maxDodges;
            isPlayerTurn = true;
            
            enemyInfoElement.textContent = `На вас напал ${bossName}!`;
            
            showMessage(`Босс ${bossName} атаковал вас! Ваш ход.`);
            updateUI();
            
            // Запуск эффекта черной кнопки только на 100 шаге и далее
            if (steps >= 100) {
                startBlackButtonEffect();
            }
            
            // Для босса ERROR запускаем эффект перемещения кнопок
            if (bossName === 'ERROR') {
                startButtonMoveEffect();
            }
            
            // Для босса БОГ ЗЛА запускаем его способности
            if (bossName === 'БОГ ЗЛА') {
                startEvilGodAbilities();
            }
            
            // Для босса БЕСКОНЕЧНОСТЬ запускаем его способности
            if (bossName === 'БЕСКОНЕЧНОСТЬ') {
                startInfinityAbilities();
            }
        }
        
        // Функция для окончания боя
        function endBattle() {
            isBattleActive = false;
            battleSection.style.display = 'none';
            stepBtn.disabled = false;
            weaponMinigame.style.display = 'none';
            
            // Сбрасываем множители атаки
            nextAttackMultiplier = 1;
            nextAttackBonusDamage = 0;
            nextEnemyDamageReduction = 1;
            
            // Останавливаем музыку после боя и включаем основную
            stopMusic();
            playMusic('mainMusic');
            
            // Остановка эффектов черных кнопок
            clearInterval(blackAttackInterval);
            clearInterval(blackInventoryInterval);
            
            // Остановка эффекта перемещения кнопок
            clearInterval(buttonMoveInterval);
            if (buttonsMoved) {
                restoreButtonOrder();
            }
            
            // Остановка эффекта яда
            clearInterval(toxicDamageInterval);
            
            // Остановка способностей боссов
            clearInterval(bossAbilityInterval);
            clearInterval(circlesInterval);
            circlesContainer.innerHTML = '';
            
            if (enemyHealth <= 0) {
                let expGained = 0;
                let coinsGained = 0;
                
                if (enemyType === 'обычный') {
                    coinsGained = 10;
                    expGained = 15;
                } else if (enemyType === 'слизень') {
                    coinsGained = 20;
                    expGained = 30;
                } else if (enemyType === 'пожиратель душ') {
                    coinsGained = 30;
                    expGained = 45;
                } else if (enemyType === 'токсичный') {
                    coinsGained = 40;
                    expGained = 60;
                } else if (enemyType === 'Король слизней') {
                    coinsGained = 100;
                    expGained = 100;
                } else if (enemyType === 'Теневой лорд') {
                    coinsGained = 250;
                    expGained = 200;
                } else if (enemyType === 'ERROR') {
                    coinsGained = 404;
                    expGained = 800;
                } else if (enemyType === 'БОГ ЗЛА') {
                    coinsGained = 800;
                    expGained = 1800;
                } else if (enemyType === 'БЕСКОНЕЧНОСТЬ') {
                    coinsGained = 0;
                    expGained = 0;
                }
                
                coins += coinsGained;
                gainExperience(expGained);
                showMessage(`Вы победили ${enemyType === 'обычный' ? 'врага' : enemyType}! Получено ${coinsGained} монет и ${expGained} опыта.`);
            } else if (playerHealth <= 0) {
                showMessage(`Вы проиграли! Начните заново.`);
                // Сброс игры
                resetGame();
            }
            
            updateUI();
        }
        
        // Функция для получения опыта
        function gainExperience(amount) {
            experience += amount;
            
            if (experience >= expToNextLevel) {
                levelUp();
            }
            
            updateUI();
        }
        
        // Функция для повышения уровня
        function levelUp() {
            isLevelUpActive = true;
            levelUpSection.style.display = 'block';
            stepBtn.disabled = true;
            
            showMessage(`Поздравляем! Вы достигли уровня ${level + 1}. Выберите улучшение.`);
        }
        
        // Функция для применения улучшения уровня
        function applyLevelUp(choice) {
            if (choice === 'dodge') {
                maxDodges += 1;
                dodgesLeft = maxDodges;
                showMessage(`Вы увеличили количество уворотов до ${maxDodges}!`);
            } else if (choice === 'coins') {
                coinsPerStep += 5;
                showMessage(`Теперь вы получаете на 5 монет больше за каждый шаг!`);
            } else if (choice === 'bonus') {
                coins += 100;
                showMessage(`Вы получили 100 монет!`);
            }
            
            level++;
            experience -= expToNextLevel;
            expToNextLevel += 10;
            
            isLevelUpActive = false;
            levelUpSection.style.display = 'none';
            stepBtn.disabled = false;
            
            updateUI();
        }
        
        // Функция для атаки игрока
        function playerAttack() {
            if (!isPlayerTurn || !isBattleActive || blackAttackActive) return;
            
            // Проверка на черную кнопку
            if (attackBtn.classList.contains('black-attack')) {
                playerHealth -= 5;
                showMessage(`Вы попали в ловушку и потеряли 5 HP!`);
                attackBtn.classList.remove('black-attack');
                blackAttackActive = false;
                
                if (playerHealth <= 0) {
                    endBattle();
                    return;
                }
                
                updateUI();
                return;
            }
            
            // Проверка оружия для мини-игры
            if (currentWeapon === 'Меч') {
                startSwordMinigame();
                return;
            } else if (currentWeapon === 'Копьё') {
                startSpearMinigame();
                return;
            } else if (currentWeapon === 'Пистолет') {
                startPistolMinigame();
                return;
            } else if (currentWeapon === 'Меч бога') {
                startGodSwordMinigame();
                return;
            }
            
            // Обычная атака
            let damageDealt = playerDamage * nextAttackMultiplier + nextAttackBonusDamage;
            
            // Сбрасываем множители после атаки
            nextAttackMultiplier = 1;
            nextAttackBonusDamage = 0;
            
            enemyHealth -= damageDealt;
            showMessage(`Вы атаковали врага и нанесли ${damageDealt} урона!`);
            
            if (enemyHealth <= 0) {
                endBattle();
                return;
            }
            
            // Переход хода к врагу
            isPlayerTurn = false;
            
            // Определение времени хода врага
            let enemyTurnTime = getEnemyTurnTime();
            
            showMessage(`Враг готовится атаковать...`, false);
            
            setTimeout(enemyTurn, enemyTurnTime * 1000);
            updateUI();
        }
        
        // Функция для защиты игрока
        function playerDefend() {
            if (!isPlayerTurn || !isBattleActive) return;
            
            // Механика защиты: 70% шанс получить 1 HP, 30% шанс потерять 2 HP
            if (Math.random() < 0.6) {
                playerHealth = Math.min(playerHealth + 5, playerMaxHealth);
                showMessage(`Вы успешно защитились и восстановили 1 HP!`);
            } else {
                playerHealth = Math.max(playerHealth - 6, 0);
                showMessage(`Защита не удалась! Вы потеряли 2 HP.`);
                
                if (playerHealth <= 0) {
                    endBattle();
                    return;
                }
            }
            
            // Переход хода к врагу
            isPlayerTurn = false;
            
            // Определение времени хода врага
            let enemyTurnTime = getEnemyTurnTime();
            
            showMessage(`Враг готовится атаковать...`, false);
            
            setTimeout(enemyTurn, enemyTurnTime * 1000);
            updateUI();
        }
        
        // Функция для уворота игрока
        function playerDodge() {
            if (isPlayerTurn || !isBattleActive || dodgesLeft <= 0) return;
            
            dodgesLeft--;
            showMessage(`Вы увернулись от атаки врага!`);
            
            // Возврат хода игроку
            isPlayerTurn = true;
            
            updateUI();
        }
        
        // Функция для хода врага
        function enemyTurn() {
            if (isPlayerTurn || !isBattleActive) return;
            
            let damageDealt = enemyDamage * nextEnemyDamageReduction;
            
            // Сбрасываем уменьшение урона врага
            nextEnemyDamageReduction = 1;
            
            // Для ERROR урон случайный от 1 до 4
            if (enemyType === 'ERROR') {
                damageDealt = Math.floor(Math.random() * 4) + 1;
            }
            
            // Учет брони
            if (hasGodArmor) {
                damageDealt = Math.floor(damageDealt * 0.4); // -60%
            } else if (hasDiamondArmor) {
                damageDealt = Math.floor(damageDealt * 0.6); // -40%
            } else if (hasIronArmor) {
                damageDealt = Math.floor(damageDealt * 0.8); // -20%
            }
            
            playerHealth -= damageDealt;
            showMessage(`Враг атаковал и нанес ${damageDealt} урона!`, false);
            
            if (playerHealth <= 0) {
                endBattle();
                return;
            }
            
            // Возврат хода игроку
            isPlayerTurn = true;
            
            showMessage(`Ваш ход!`);
            updateUI();
        }
        
        // Функция для мини-игры меча
        function startSwordMinigame() {
            weaponMinigame.style.display = 'block';
            weaponMinigame.innerHTML = `
                <h3>Атака мечом!</h3>
                <p>Нажмите кнопку "Замах" дважды в течение 4 секунд</p>
                <div class="minigame-timer">
                    <div class="timer-bar" id="swordTimer"></div>
                </div>
                <button class="minigame-btn" id="swordSwingBtn">Замах</button>
                <p>Нажато: <span id="swordSwings">0</span>/2</p>
            `;
            
            const swordTimer = document.getElementById('swordTimer');
            const swordSwingBtn = document.getElementById('swordSwingBtn');
            const swordSwingsElement = document.getElementById('swordSwings');
            
            let swings = 0;
            let timeLeft = 4;
            
            const timerInterval = setInterval(() => {
                timeLeft -= 0.1;
                swordTimer.style.width = `${(timeLeft / 4) * 100}%`;
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    // Неудачная атака
                    enemyHealth -= 2;
                    showMessage(`Вы не успели сделать полную атаку! Нанесено только 2 урона.`);
                    weaponMinigame.style.display = 'none';
                    
                    if (enemyHealth <= 0) {
                        endBattle();
                        return;
                    }
                    
                    // Переход хода к врагу
                    isPlayerTurn = false;
                    let enemyTurnTime = getEnemyTurnTime();
                    showMessage(`Враг готовится атаковать...`, false);
                    setTimeout(enemyTurn, enemyTurnTime * 1000);
                    updateUI();
                }
            }, 100);
            
            swordSwingBtn.addEventListener('click', () => {
                swings++;
                swordSwingsElement.textContent = swings;
                
                if (swings >= 2) {
                    clearInterval(timerInterval);
                    // Успешная атака
                    let damageDealt = 4 * nextAttackMultiplier + nextAttackBonusDamage;
                    nextAttackMultiplier = 1;
                    nextAttackBonusDamage = 0;
                    
                    enemyHealth -= damageDealt;
                    showMessage(`Вы успешно атаковали мечом! Нанесено ${damageDealt} урона.`);
                    weaponMinigame.style.display = 'none';
                    
                    if (enemyHealth <= 0) {
                        endBattle();
                        return;
                    }
                    
                    // Переход хода к врагу
                    isPlayerTurn = false;
                    let enemyTurnTime = getEnemyTurnTime();
                    showMessage(`Враг готовится атаковать...`, false);
                    setTimeout(enemyTurn, enemyTurnTime * 1000);
                    updateUI();
                }
            });
        }
        
        // Функция для мини-игры копья
        function startSpearMinigame() {
            weaponMinigame.style.display = 'block';
            weaponMinigame.innerHTML = `
                <h3>Атака копьём!</h3>
                <p>Зажмите кнопку на 3 секунды</p>
                <div class="minigame-timer">
                    <div class="timer-bar" id="spearTimer"></div>
                </div>
                <button class="minigame-btn" id="spearHoldBtn">Удерживайте для атаки</button>
            `;
            
            const spearTimer = document.getElementById('spearTimer');
            const spearHoldBtn = document.getElementById('spearHoldBtn');
            
            let holdTime = 0;
            let holding = false;
            const requiredTime = 3;
            
            const holdInterval = setInterval(() => {
                if (holding) {
                    holdTime += 0.1;
                    spearTimer.style.width = `${(holdTime / requiredTime) * 100}%`;
                    
                    if (holdTime >= requiredTime) {
                        clearInterval(holdInterval);
                        // Успешная атака
                        const baseDamage = Math.floor(Math.random() * 4) + 3; // 3-6 урона
                        let damageDealt = baseDamage * nextAttackMultiplier + nextAttackBonusDamage;
                        nextAttackMultiplier = 1;
                        nextAttackBonusDamage = 0;
                        
                        enemyHealth -= damageDealt;
                        showMessage(`Вы успешно атаковали копьём! Нанесено ${damageDealt} урона.`);
                        weaponMinigame.style.display = 'none';
                        
                        if (enemyHealth <= 0) {
                            endBattle();
                            return;
                        }
                        
                        // Переход хода к врагу
                        isPlayerTurn = false;
                        let enemyTurnTime = getEnemyTurnTime();
                        showMessage(`Враг готовится атаковать...`, false);
                        setTimeout(enemyTurn, enemyTurnTime * 1000);
                        updateUI();
                    }
                }
            }, 100);
            
            spearHoldBtn.addEventListener('mousedown', () => {
                holding = true;
            });
            
            spearHoldBtn.addEventListener('mouseup', () => {
                holding = false;
                if (holdTime < requiredTime) {
                    clearInterval(holdInterval);
                    // Неудачная атака
                    enemyHealth -= 2;
                    showMessage(`Вы не удержали копьё достаточно долго! Нанесено только 2 урона.`);
                    weaponMinigame.style.display = 'none';
                    
                    if (enemyHealth <= 0) {
                        endBattle();
                        return;
                    }
                    
                    // Переход хода к врагу
                    isPlayerTurn = false;
                    let enemyTurnTime = getEnemyTurnTime();
                    showMessage(`Враг готовится атаковать...`, false);
                    setTimeout(enemyTurn, enemyTurnTime * 1000);
                    updateUI();
                }
            });
        }
        
        // Функция для мини-игры пистолета
        function startPistolMinigame() {
            weaponMinigame.style.display = 'block';
            weaponMinigame.innerHTML = `
                <h3>Стрельба из пистолета!</h3>
                <p>Нажмите кнопку "Стрелять", когда она станет жёлтой</p>
                <button class="minigame-btn" id="pistolShootBtn" style="background: gray">Стрелять</button>
            `;
            
            const pistolShootBtn = document.getElementById('pistolShootBtn');
            
            const waitTime = Math.random() * 2 + 2; // 2-4 секунды
            let canShoot = false;
            
            setTimeout(() => {
                canShoot = true;
                pistolShootBtn.style.background = '#ffeb3b';
                pistolShootBtn.style.color = 'black';
                
                setTimeout(() => {
                    if (canShoot) {
                        canShoot = false;
                        pistolShootBtn.style.background = 'gray';
                        pistolShootBtn.style.color = 'white';
                        // Неудачная стрельба
                        enemyHealth -= 2;
                        showMessage(`Вы не успели выстрелить вовремя! Нанесено только 2 урона.`);
                        weaponMinigame.style.display = 'none';
                        
                        if (enemyHealth <= 0) {
                            endBattle();
                            return;
                        }
                        
                        // Переход хода к врагу
                        isPlayerTurn = false;
                        let enemyTurnTime = getEnemyTurnTime();
                        showMessage(`Враг готовится атаковать...`, false);
                        setTimeout(enemyTurn, enemyTurnTime * 1000);
                        updateUI();
                    }
                }, 500); // 0.5 секунды на реакцию
            }, waitTime * 1000);
            
            pistolShootBtn.addEventListener('click', () => {
                if (canShoot) {
                    canShoot = false;
                    pistolShootBtn.style.background = 'gray';
                    pistolShootBtn.style.color = 'white';
                    // Успешная стрельба
                    let damageDealt = 5 * nextAttackMultiplier + nextAttackBonusDamage;
                    nextAttackMultiplier = 1;
                    nextAttackBonusDamage = 0;
                    
                    enemyHealth -= damageDealt;
                    showMessage(`Вы успешно выстрелили! Нанесено ${damageDealt} урона.`);
                    weaponMinigame.style.display = 'none';
                    
                    if (enemyHealth <= 0) {
                        endBattle();
                        return;
                    }
                    
                    // Переход хода к врагу
                    isPlayerTurn = false;
                    let enemyTurnTime = getEnemyTurnTime();
                    showMessage(`Враг готовится атаковать...`, false);
                    setTimeout(enemyTurn, enemyTurnTime * 1000);
                    updateUI();
                }
            });
        }
        
        // Функция для мини-игры меча бога
        function startGodSwordMinigame() {
            weaponMinigame.style.display = 'block';
            weaponMinigame.innerHTML = `
                <h3>Атака мечом бога!</h3>
                <p>Нажмите кнопку "Замах" трижды в течение 3 секунд</p>
                <div class="minigame-timer">
                    <div class="timer-bar" id="godSwordTimer"></div>
                </div>
                <button class="minigame-btn" id="godSwordSwingBtn">Замах</button>
                <p>Нажато: <span id="godSwordSwings">0</span>/3</p>
            `;
            
            const godSwordTimer = document.getElementById('godSwordTimer');
            const godSwordSwingBtn = document.getElementById('godSwordSwingBtn');
            const godSwordSwingsElement = document.getElementById('godSwordSwings');
            
            let swings = 0;
            let timeLeft = 3;
            
            const timerInterval = setInterval(() => {
                timeLeft -= 0.1;
                godSwordTimer.style.width = `${(timeLeft / 3) * 100}%`;
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    // Неудачная атака
                    enemyHealth -= 10;
                    showMessage(`Вы не успели сделать полную атаку! Нанесено только 10 урона.`);
                    weaponMinigame.style.display = 'none';
                    
                    if (enemyHealth <= 0) {
                        endBattle();
                        return;
                    }
                    
                    // Переход хода к врагу
                    isPlayerTurn = false;
                    let enemyTurnTime = getEnemyTurnTime();
                    showMessage(`Враг готовится атаковать...`, false);
                    setTimeout(enemyTurn, enemyTurnTime * 1000);
                    updateUI();
                }
            }, 100);
            
            godSwordSwingBtn.addEventListener('click', () => {
                swings++;
                godSwordSwingsElement.textContent = swings;
                
                if (swings >= 3) {
                    clearInterval(timerInterval);
                    // Успешная атака
                    let damageDealt = 20 * nextAttackMultiplier + nextAttackBonusDamage;
                    nextAttackMultiplier = 1;
                    nextAttackBonusDamage = 0;
                    
                    enemyHealth -= damageDealt;
                    showMessage(`Вы успешно атаковали мечом бога! Нанесено ${damageDealt} урона.`);
                    weaponMinigame.style.display = 'none';
                    
                    if (enemyHealth <= 0) {
                        endBattle();
                        return;
                    }
                    
                    // Переход хода к врагу
                    isPlayerTurn = false;
                    let enemyTurnTime = getEnemyTurnTime();
                    showMessage(`Враг готовится атаковать...`, false);
                    setTimeout(enemyTurn, enemyTurnTime * 1000);
                    updateUI();
                }
            });
        }
        
        // Функция для получения времени хода врага
        function getEnemyTurnTime() {
            if (enemyType === 'слизень') {
                return Math.random() * 0.75 + 0.75;
            } else if (enemyType === 'Король слизней') {
                return Math.random() * 0.25 + 0.5;
            } else if (enemyType === 'Теневой лорд') {
                return 1;
            } else if (enemyType === 'ERROR') {
                return Math.random() * 1.0 + 0.4;
            } else if (enemyType === 'пожиратель душ') {
                return Math.random() * 1.0 + 1.0;
            } else if (enemyType === 'токсичный') {
                return Math.random() * 0.1 + 1.0;
            } else if (enemyType === 'БОГ ЗЛА') {
                return Math.random() * 0.9 + 0.6;
            } else if (enemyType === 'БЕСКОНЕЧНОСТЬ') {
                return Math.random() * 0.3 + 0.3;
            } else {
                return Math.random() * 1.5 + 1.5;
            }
        }
        
        // Функция для эффекта черной кнопки
        let blackAttackInterval;
        let blackInventoryInterval;
        
        function startBlackButtonEffect() {
            // Для кнопки атаки
            blackAttackInterval = setInterval(() => {
                if (isBattleActive && isPlayerTurn) {
                    if (Math.random() < 0.4) { // 40% шанс
                        attackBtn.classList.add('black-attack');
                        blackAttackActive = true;
                        
                        setTimeout(() => {
                            attackBtn.classList.remove('black-attack');
                            blackAttackActive = false;
                        }, 2000); // 2 секунды
                    }
                }
            }, 3000); // Каждые 3 секунды
            
            // Для инвентаря
            blackInventoryInterval = setInterval(() => {
                if (isBattleActive && isPlayerTurn) {
                    if (Math.random() < 0.4) { // 40% шанс
                        blackInventoryActive = true;
                        
                        setTimeout(() => {
                            blackInventoryActive = false;
                        }, 2000); // 2 секунды
                    }
                }
            }, 5000); // Каждые 5 секунды
        }
        
        // Функция для эффекта перемещения кнопок (для босса ERROR)
        let buttonMoveInterval;
        
        function startButtonMoveEffect() {
            // Сохраняем оригинальный порядок кнопок
            originalButtonOrder = Array.from(playerActions.children);
            
            buttonMoveInterval = setInterval(() => {
                if (isBattleActive && !buttonsMoved) {
                    // Перемешиваем кнопки
                    const buttons = Array.from(playerActions.children);
                    for (let i = buttons.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        playerActions.appendChild(buttons[j]);
                    }
                    buttonsMoved = true;
                    showMessage(`Кнопки перемешаны! Будьте внимательны!`);
                    
                    // Через 5 секунд возвращаем обратно
                    setTimeout(() => {
                        if (isBattleActive) {
                            restoreButtonOrder();
                            buttonsMoved = false;
                            showMessage(`Кнопки вернулись на место!`);
                        }
                    }, 5000);
                }
            }, 10000); // Каждые 10 секунды
        }
        
        // Функция для восстановления оригинального порядка кнопок
        function restoreButtonOrder() {
            playerActions.innerHTML = '';
            originalButtonOrder.forEach(button => {
                playerActions.appendChild(button);
            });
        }
        
        // Функция для эффекта яда (для токсичного врага)
        function startToxicDamage() {
            toxicDamageInterval = setInterval(() => {
                if (isBattleActive) {
                    playerHealth = Math.max(playerHealth - 0.5, 0);
                    showMessage(`Токсичный яд наносит 0.5 урона!`);
                    
                    if (playerHealth <= 0) {
                        endBattle();
                    } else {
                        updateUI();
                    }
                }
            }, 2000); // Каждые 2 секунды
        }
        
        // Функция для способностей БОГА ЗЛА
        function startEvilGodAbilities() {
            // Способность 1: отбирает предмет из инвентаря каждые 20-40 секунд
            bossAbilityInterval = setInterval(() => {
                if (isBattleActive && inventory.length > 0) {
                    // Ищем предметы, которые не являются божественными
                    const nonGodItems = inventory.filter(item => 
                        !item.name.includes('бога') && !item.name.includes('Бога')
                    );
                    
                    if (nonGodItems.length > 0) {
                        const randomIndex = Math.floor(Math.random() * nonGodItems.length);
                        const stolenItem = nonGodItems[randomIndex];
                        inventory.splice(inventory.findIndex(item => item.id === stolenItem.id), 1);
                        showMessage(`Бог зла украл ваш предмет: ${stolenItem.name}!`);
                        updateInventory();
                    }
                }
            }, (Math.random() * 20 + 20) * 1000); // 20-40 секунд
            
            // Способность 2: спавнит кружки каждые 10-20 секунд
            circlesInterval = setInterval(() => {
                if (isBattleActive) {
                    spawnCircles();
                }
            }, (Math.random() * 10 + 10) * 1000); // 10-20 секунд
        }
        
        // Функция для спавна кружков
        function spawnCircles() {
            circlesContainer.innerHTML = '';
            const circles = [];
            
            // Создаем 5 кружков
            for (let i = 0; i < 5; i++) {
                const circle = document.createElement('div');
                circle.className = 'circle';
                circle.style.left = `${Math.random() * 80 + 10}%`;
                circle.style.top = `${Math.random() * 80 + 10}%`;
                
                circle.addEventListener('click', () => {
                    circle.remove();
                    // Проверяем, все ли кружки уничтожены
                    if (circlesContainer.children.length === 0) {
                        showMessage(`Вы успешно уничтожили все кружки!`);
                    }
                });
                
                circlesContainer.appendChild(circle);
                circles.push(circle);
            }
            
            showMessage(`Появились кружки! Уничтожьте их за 10 секунд!`);
            
            // Через 10 секунд проверяем, остались ли кружки
            setTimeout(() => {
                if (circlesContainer.children.length > 0) {
                    circlesContainer.innerHTML = '';
                    playerHealth = Math.max(playerHealth - 12, 0);
                    showMessage(`Вы не успели уничтожить все кружки! Потеряно 12 HP.`);
                    
                    if (playerHealth <= 0) {
                        endBattle();
                    } else {
                        updateUI();
                    }
                }
            }, 10000);
        }
        
        // Функция для способностей БЕСКОНЕЧНОСТИ
        function startInfinityAbilities() {
            bossAbilityInterval = setInterval(() => {
                if (isBattleActive) {
                    // Случайная способность боссов
                    const abilities = [
                        'blackAttack',
                        'buttonMove',
                        'toxicDamage',
                        'stealItem',
                        'circles'
                    ];
                    
                    const randomAbility = abilities[Math.floor(Math.random() * abilities.length)];
                    
                    switch(randomAbility) {
                        case 'blackAttack':
                            attackBtn.classList.add('black-attack');
                            blackAttackActive = true;
                            setTimeout(() => {
                                attackBtn.classList.remove('black-attack');
                                blackAttackActive = false;
                            }, 2000);
                            showMessage(`Бесконечность активировала черные кнопки!`);
                            break;
                            
                        case 'buttonMove':
                            if (!buttonsMoved) {
                                originalButtonOrder = Array.from(playerActions.children);
                                const buttons = Array.from(playerActions.children);
                                for (let i = buttons.length - 1; i > 0; i--) {
                                    const j = Math.floor(Math.random() * (i + 1));
                                    playerActions.appendChild(buttons[j]);
                                }
                                buttonsMoved = true;
                                showMessage(`Бесконечность перемешала кнопки!`);
                                
                                setTimeout(() => {
                                    if (isBattleActive) {
                                        restoreButtonOrder();
                                        buttonsMoved = false;
                                        showMessage(`Кнопки вернулись на место!`);
                                    }
                                }, 5000);
                            }
                            break;
                            
                        case 'toxicDamage':
                            playerHealth = Math.max(playerHealth - 2, 0);
                            showMessage(`Бесконечность применила токсичный яд! Потеряно 2 HP.`);
                            
                            if (playerHealth <= 0) {
                                endBattle();
                            } else {
                                updateUI();
                            }
                            break;
                            
                        case 'stealItem':
                            if (inventory.length > 0) {
                                const nonGodItems = inventory.filter(item => 
                                    !item.name.includes('бога') && !item.name.includes('Бога')
                                );
                                
                                if (nonGodItems.length > 0) {
                                    const randomIndex = Math.floor(Math.random() * nonGodItems.length);
                                    const stolenItem = nonGodItems[randomIndex];
                                    inventory.splice(inventory.findIndex(item => item.id === stolenItem.id), 1);
                                    showMessage(`Бесконечность украла ваш предмет: ${stolenItem.name}!`);
                                    updateInventory();
                                }
                            }
                            break;
                            
                        case 'circles':
                            spawnCircles();
                            break;
                    }
                }
            }, 35000); // Каждые 35 секунд
        }
        
        // Функция для показа магазина
        function showShop() {
            isShopActive = true;
            shopSection.style.display = 'block';
            stepBtn.disabled = true;
            
            // Заполнение магазина товарами
            shopItemsElement.innerHTML = '';
            
            // С шансом 10% добавляем сундук (только при первом показе магазина)
            let hasChest = false;
            shopItems.forEach(item => {
                const shopItemElement = document.createElement('div');
                shopItemElement.className = 'shop-item';
                shopItemElement.innerHTML = `
                    <h3>${item.name}</h3>
                    <div>${item.description}</div>
                    <div>Цена: ${item.price} монет</div>
                    <button class="shop-btn" data-id="${item.id}" data-price="${item.price}" ${coins < item.price ? 'disabled' : ''}>Купить</button>
                `;
                shopItemsElement.appendChild(shopItemElement);
            });
            
            // Добавление обработчиков событий для кнопок покупки
            document.querySelectorAll('.shop-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const itemId = e.target.getAttribute('data-id');
                    const itemPrice = parseInt(e.target.getAttribute('data-price'));
                    buyItem(itemId, itemPrice);
                });
            });
            
            showMessage('Вы попали в магазин! Можно купить улучшения или продолжить путь.');
        }
        
        // Функция для покупки предмета
        function buyItem(itemId, price) {
            if (coins >= price) {
                coins -= price;
                
                const item = shopItems.find(i => i.id === itemId);
                
                if (item.type === 'weapon') {
                    currentWeapon = item.name;
                    playerDamage = getWeaponDamage(item.name);
                    playerBaseDamage = playerDamage; // Сохраняем базовый урон
                    showMessage(`Вы купили ${item.name}! Теперь ваш урон: ${playerDamage}.`);
                } else if (item.type === 'armor') {
                    if (itemId === 'ironArmor') {
                        hasIronArmor = true;
                        hasDiamondArmor = false;
                        hasGodArmor = false;
                    } else if (itemId === 'diamondArmor') {
                        hasDiamondArmor = true;
                        hasIronArmor = false;
                        hasGodArmor = false;
                    } else if (itemId === 'godArmor') {
                        hasGodArmor = true;
                        hasIronArmor = false;
                        hasDiamondArmor = false;
                    }
                    showMessage(`Вы купили ${item.name}!`);
                } else if (item.type === 'consumable') {
                    inventory.push(item);
                    showMessage(`Вы купили ${item.name} и добавили в инвентарь!`);
                } else if (item.type === 'stat') {
                    if (itemId === 'maxHp') {
                        playerMaxHealth += 1;
                        playerHealth = playerMaxHealth;
                        showMessage(`Вы увеличили максимальное здоровье до ${playerMaxHealth}!`);
                    }
                } else if (item.type === 'tool') {
                    if (itemId === 'pickaxe') {
                        hasPickaxe = true;
                        showMessage(`Вы купили кирку! Теперь вы можете добывать золотую руду.`);
                    }
                }
                
                updateUI();
                updateShopItems(); // Обновляем доступность кнопок в магазине
            }
        }
        
        // Функция для обновления доступности товаров в магазине
        function updateShopItems() {
            document.querySelectorAll('.shop-btn').forEach(btn => {
                const itemPrice = parseInt(btn.getAttribute('data-price'));
                btn.disabled = coins < itemPrice;
            });
        }
        
        // Функция для получения урона оружия
        function getWeaponDamage(weaponName) {
            switch(weaponName) {
                case 'кулаки': return 1;
                case 'Перчатка': return 2;
                case 'Меч': return 4;
                case 'Копьё': return 3; // Минимальный урон
                case 'Пистолет': return 5;
                case 'Перчатка вечности': return 10;
                case 'Меч бога': return 20;
                default: return 1;
            }
        }
        
        // Функция для скрытия магазина
        function hideShop() {
            isShopActive = false;
            shopSection.style.display = 'none';
            stepBtn.disabled = false;
            showMessage('Магазин закрыт. Продолжайте путь!');
        }
        
        // Функция для показа золотой руды
        function showOre() {
            isOreActive = true;
            oreSection.style.display = 'block';
            stepBtn.disabled = true;
            mineCount = 0;
            mineCountElement.textContent = mineCount;
            
            showMessage('Вы нашли золотую руду! Используйте кирку, чтобы добыть её.');
        }
        
        // Функция для скрытия золотой руды
        function hideOre() {
            isOreActive = false;
            oreSection.style.display = 'none';
            stepBtn.disabled = false;
        }
        
        // Функция для добычи руды
        function mineOre() {
            if (!hasPickaxe) {
                showMessage('У вас нет кирки! Купите её в магазине.');
                return;
            }
            
            mineCount++;
            mineCountElement.textContent = mineCount;
            
            if (mineCount >= 30) {
                const coinsEarned = Math.floor(Math.random() * 151) + 150; // 150-300 монет
                coins += coinsEarned;
                showMessage(`Вы добыли золотую руду и получили ${coinsEarned} монет!`);
                hideOre();
                updateUI();
            }
        }
        
        // Функция для обновления инвентаря
        function updateInventory() {
            inventoryItemsElement.innerHTML = '';
            
            if (inventory.length === 0) {
                inventoryItemsElement.innerHTML = '<p>Инвентарь пуст</p>';
                return;
            }
            
            // Группируем предметы по типам
            const groupedItems = {};
            inventory.forEach(item => {
                if (!groupedItems[item.id]) {
                    groupedItems[item.id] = { ...item, count: 1 };
                } else {
                    groupedItems[item.id].count++;
                }
            });
            
            // Отображаем предметы
            Object.values(groupedItems).forEach(item => {
                const inventoryItemElement = document.createElement('div');
                inventoryItemElement.className = 'inventory-item';
                inventoryItemElement.innerHTML = `
                    <h4>${item.name}</h4>
                    <div>${item.description}</div>
                    <div>Количество: ${item.count}</div>
                    <button class="inventory-btn" data-id="${item.id}" ${!isPlayerTurn || blackInventoryActive ? 'disabled' : ''}>Использовать</button>
                `;
                inventoryItemsElement.appendChild(inventoryItemElement);
            });
            
            // Добавление обработчиков событий для кнопок использования
            document.querySelectorAll('.inventory-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    if (blackInventoryActive) {
                        playerHealth -= 5;
                        showMessage(`Вы попали в ловушку и потеряли 5 HP!`);
                        blackInventoryActive = false;
                        
                        if (playerHealth <= 0) {
                            endBattle();
                            return;
                        }
                        
                        updateUI();
                        return;
                    }
                    
                    const itemId = e.target.getAttribute('data-id');
                    useItem(itemId);
                });
            });
        }
        
        // Функция для использования предмета из инвентаря
        function useItem(itemId) {
            const itemIndex = inventory.findIndex(item => item.id === itemId);
            if (itemIndex === -1) return;
            
            const item = inventory[itemIndex];
            
            switch(item.id) {
                case 'healthSphere':
                    playerHealth = Math.min(playerHealth + 15, playerMaxHealth);
                    showMessage(`Вы использовали Сферу жизни и восстановили 15 HP!`);
                    break;
                case 'rageSphere':
                    nextAttackMultiplier *= 2;
                    showMessage(`Вы использовали Сферу ярости! Следующая атака будет нанесена с удвоенным уроном.`);
                    break;
                case 'comboSphere':
                    playerHealth = Math.min(playerHealth + 10, playerMaxHealth);
                    nextAttackMultiplier *= 2;
                    showMessage(`Вы использовали Сферу комбо! Восстановлено 10 HP, и следующая атака будет нанесена с удвоенным уроном.`);
                    break;
                case 'baton':
                    playerHealth = Math.min(playerHealth + 10, playerMaxHealth);
                    nextEnemyDamageReduction = 0.5;
                    showMessage(`Вы использовали Батон! Восстановлено 10 HP, и следующий урон врага будет уменьшен вдвое.`);
                    break;
                case 'mushroomBottle':
                    gainExperience(50);
                    showMessage(`Вы использовали Бутылочку опята и получили 50 опыта!`);
                    break;
                case 'godSphere':
                    playerHealth -= 5;
                    nextAttackMultiplier *= 5;
                    showMessage(`Вы использовали Сферу бога! Следующая атака будет нанесена с уроном в 5 раз больше, но вы потеряли 5 HP.`);
                    break;
            }
            
            // Удаляем предмет из инвентаря
            inventory.splice(itemIndex, 1);
            
            updateUI();
        }
        
        // Функция для окончания игры
        function endGame() {
            endGameSection.style.display = 'block';
            stepBtn.disabled = true;
            battleSection.style.display = 'none';
            shopSection.style.display = 'none';
            inventorySection.style.display = 'none';
            
            finalScoreElement.textContent = coins;
            finalLevelElement.textContent = level;
            
            showMessage('Поздравляем! Вы достигли 1000 шагов и победили игру!');
        }
        
        // Функция для сброса игры
        function resetGame() {
            steps = 0;
            coins = 0;
            playerHealth = 5;
            playerMaxHealth = 5;
            playerDamage = 1;
            playerBaseDamage = 1;
            experience = 0;
            level = 1;
            expToNextLevel = 100;
            coinsPerStep = 1;
            inventory = [];
            currentWeapon = 'кулаки';
            hasIronArmor = false;
            hasDiamondArmor = false;
            hasGodArmor = false;
            hasPickaxe = false;
            maxDodges = 3;
            dodgesLeft = 3;
            nextAttackMultiplier = 1;
            nextAttackBonusDamage = 0;
            nextEnemyDamageReduction = 1;
            
            // Скрываем все секции и показываем только основную
            battleSection.style.display = 'none';
            shopSection.style.display = 'none';
            levelUpSection.style.display = 'none';
            oreSection.style.display = 'none';
            endGameSection.style.display = 'none';
            
            // Инвентарь всегда виден
            inventorySection.style.display = 'block';
            
            stepBtn.disabled = false;
            
            // Включаем основную музыку
            playMusic('mainMusic');
            
            updateUI();
            showMessage('Игра сброшена. Сделайте шаг, чтобы начать заново!');
        }
        
        // Назначение обработчиков событий для музыки
        mainMusicBtn.addEventListener('click', () => playMusic('mainMusic'));
        boss50MusicBtn.addEventListener('click', () => playMusic('boss50Music'));
        boss100MusicBtn.addEventListener('click', () => playMusic('boss100Music'));
        boss250MusicBtn.addEventListener('click', () => playMusic('boss250Music'));
        boss500MusicBtn.addEventListener('click', () => playMusic('boss500Music'));
        boss999MusicBtn.addEventListener('click', () => playMusic('boss999Music'));
        stopMusicBtn.addEventListener('click', stopMusic);
        
        // Остальные обработчики событий
        stepBtn.addEventListener('click', makeStep);
        attackBtn.addEventListener('click', playerAttack);
        defendBtn.addEventListener('click', playerDefend);
        dodgeBtn.addEventListener('click', playerDodge);
        continueBtn.addEventListener('click', hideShop);
        levelUpDodgeBtn.addEventListener('click', () => applyLevelUp('dodge'));
        levelUpCoinsBtn.addEventListener('click', () => applyLevelUp('coins'));
        levelUpBonusBtn.addEventListener('click', () => applyLevelUp('bonus'));
        mineBtn.addEventListener('click', mineOre);
        oreContinueBtn.addEventListener('click', hideOre);
        restartBtn.addEventListener('click', resetGame);
        
        // Инициализация игры
        inventorySection.style.display = 'block'; // Инвентарь всегда виден
        playMusic('mainMusic'); // Включаем основную музыку при запуске
        updateUI();
    </script>
</body>
</html>
